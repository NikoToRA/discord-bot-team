# リアルタイムルームログボット

指定されたDiscordルーム（チャンネル）のメッセージをリアルタイムで記録し、グッドマークリアクションでログファイルをダウンロード可能にするボットです。

## 機能概要

### 📝 リアルタイムログ記録
- **対象ルーム**: `1418511738046779393` (room1)
- **動作**: メッセージが投稿されるたびに即座にログファイルに追記
- **記録内容**: 投稿日時、投稿者、メッセージ内容、添付ファイル、リアクション

### 📋 ログダウンロード機能
- **トリガー**: 任意のメッセージに👍リアクションを付ける
- **動作**: 現在のログファイルをDiscordにアップロード
- **制限**: 8MB以下のファイルのみDiscordアップロード可能

## ファイル構成

### 生成されるファイル
```
/Users/suguruhirayama/Desktop/AI実験室/Discordbot/
├── room_1418511738046779393_log.txt         # メインログファイル
└── room_1418511738046779393_metadata.json   # メタデータファイル
```

### ログファイル形式
```
=== Room 1418511738046779393 リアルタイムログ ===
ログ開始: 2025年01月20日 16時30分15秒
============================================================

[2025-01-20 16:30:20] UserName#1234
内容: こんにちは！
メッセージID: 1234567890123456789
----------------------------------------

[2025-01-20 16:31:15] AnotherUser#5678
内容: 画像を投稿しました
添付ファイル: https://cdn.discordapp.com/attachments/...
リアクション: 👍(2), ❤️(1)
メッセージID: 9876543210987654321
----------------------------------------
```

### メタデータファイル形式
```json
{
  "room_id": 1418511738046779393,
  "log_start_time": "2025-01-20T16:30:15.123456",
  "message_count": 42,
  "last_updated": "2025-01-20T17:45:30.789012"
}
```

## 使用方法

### 1. ボット起動
```bash
cd /Users/suguruhirayama/Desktop/AI実験室/Discordbot
python sample02_roomlog.py
```

### 2. Discord上での操作

#### ログダウンロード
1. room1 (ID: 1418511738046779393) で任意のメッセージに👍を付ける
2. ボットがログファイルをアップロード

#### ログ状況確認
```
!logstatus
```
- 現在の累計メッセージ数
- ログファイルサイズ
- ログ開始時刻
- 最終更新時刻

#### 機能説明表示
```
!roomloginfo
```

## 特徴

### ✅ メリット
- **リアルタイム記録**: メッセージと同時に記録（遅延なし）
- **永続化**: ボット再起動してもログは保持される
- **軽量**: 必要最小限のリソース使用
- **簡単操作**: 👍リアクションだけでダウンロード

### ⚠️ 注意事項
- **対象ルーム限定**: 指定されたルーム（1418511738046779393）のみ
- **ファイルサイズ制限**: 8MBを超えるとDiscordアップロード不可
- **権限必要**: ボットが対象チャンネルの読み書き権限を持つ必要あり
- **ローカル保存**: ログファイルはローカルディスクに保存

## トラブルシューティング

### ボットがログを記録しない
- 対象ルームID（1418511738046779393）を確認
- ボットがチャンネルにアクセス権限を持っているか確認
- ファイル書き込み権限を確認

### ログファイルがアップロードされない
- ファイルサイズが8MB以下か確認
- ボットがファイル送信権限を持っているか確認
- ログファイルの存在確認

### メタデータエラー
- `room_1418511738046779393_metadata.json`を削除して再起動

## 環境変数

`.env`ファイルに以下を設定：
```
DISCORD_TOKEN=your_discord_bot_token_here
```

## 必要な権限

Discord Application で以下の権限が必要：
- `Read Messages`
- `Send Messages`
- `Read Message History` 
- `Add Reactions`
- `Attach Files`